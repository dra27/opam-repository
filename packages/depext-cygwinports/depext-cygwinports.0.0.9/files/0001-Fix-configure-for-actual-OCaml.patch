From d92291230174bc27580b90c81c561f46c285b691 Mon Sep 17 00:00:00 2001
From: David Allsopp <david.allsopp@metastack.com>
Date: Tue, 10 Jan 2023 12:01:30 +0000
Subject: [PATCH 1/2] Fix configure for actual OCaml

---
 Makefile  | 4 ++--
 configure | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index 5d28e4e..68c4d32 100644
--- a/Makefile
+++ b/Makefile
@@ -3,8 +3,8 @@
 PREFIX?= /usr/local
 OCAMLFLAGS= -g #-bin-annot -safe-string -w A-4-39
 
-OSTYPE:=$(shell ocamlc -config | awk '/^os_type/ { print $$2}')
-CC:= $(shell ocamlc -config | awk '/^bytecomp_c_compiler/ {for(i=2;i<=NF;i++) printf "%s " ,$$i}')
+OSTYPE:=$(shell ocamlc -config | tr -d '\r' | awk '/^os_type/ { print $$2}')
+CC:= $(shell ocamlc -config | tr -d '\r' | awk '/^bytecomp_c_compiler/ {for(i=2;i<=NF;i++) printf "%s " ,$$i}')
 
 ifeq ($(OSTYPE),$(filter $(OSTYPE),Win32 Cygwin))
 all: cygwin-install.exe pkg-config.exe
diff --git a/configure b/configure
index 325903c..1775729 100755
--- a/configure
+++ b/configure
@@ -5,7 +5,7 @@ set -eu
 cygwin_root="$(cygpath -m /)"
 cygwin_arch="$(uname -m)"
 
-mingw_arch="$(ocamlc -config 2>/dev/null | awk '/^system/ {print $2}')"
+mingw_arch="$(ocamlc -config 2>/dev/null | tr -d '\r' | awk '/^system/ {print $2}')"
 
 if [ "$mingw_arch" != "mingw64" ] && [ "$mingw_arch" != "mingw" ] ; then
     echo "unsupported mingw_arch: '$mingw_arch'" >&2
-- 
2.34.1

