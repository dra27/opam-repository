opam-version: "2.0"
synopsis: "Fast, portable, and opinionated build system"
description: """

Dune is a build system that was designed to simplify the release of
Jane Street packages. It reads metadata from "dune" files following a
very simple s-expression syntax.

Dune is fast, has very low-overhead, and supports parallel builds on
all platforms. It has no system dependencies; all you need to build
dune or packages using dune is OCaml. You don't need make or bash
as long as the packages themselves don't use bash explicitly.

Dune is composable; supporting multi-package development by simply
dropping multiple repositories into the same directory.

Dune also supports multi-context builds, such as building against
several opam roots/switches simultaneously. This helps maintaining
packages across several versions of OCaml and gives cross-compilation
for free.
"""
maintainer: ["Jane Street Group, LLC <opensource@janestreet.com>"]
authors: ["Jane Street Group, LLC <opensource@janestreet.com>"]
license: "MIT"
homepage: "https://github.com/ocaml/dune"
doc: "https://dune.readthedocs.io/"
bug-reports: "https://github.com/ocaml/dune/issues"
conflicts: [
  "dune"
  "merlin" {< "3.4.0"}
  "ocaml-lsp-server" {< "1.3.0"}
  "dune-configurator" {< "2.3.0"}
  "odoc" {< "2.0.1"}
  "dune-release" {< "1.3.0"}
  "js_of_ocaml-compiler" {< "3.6.0"}
  "jbuilder" {= "transition"}
]
dev-repo: "git+https://github.com/ocaml/dune.git"
build-env: [PATH += "%{ocaml-secondary-compiler:share}%/bin"]
build: [
  ["sh" "-c" "echo '(version \"Dune Developer Preview: build 2024-09-18, git revision 4f86203f77eb7ead7a07286b7728cbf42a386990\")' >> dune-project"]
  ["sh" "-exc" "PATH=%{ocaml-secondary-compiler:share}%/bin:$PATH ocaml boot/configure.ml --enable-toolchains --enable-pkg-build-progress --enable-lock-dev-tool"] { opam-version < "2.1.5"}
  ["ocaml" "boot/configure.ml" "--enable-toolchains" "--enable-pkg-build-progress" "--enable-lock-dev-tool"]
  ["sh" "-exc" "PATH=%{ocaml-secondary-compiler:share}%/bin:$PATH ocaml boot/bootstrap.ml -j %{jobs}%"] { opam-version < "2.1.5"}
  ["ocaml" "boot/bootstrap.ml" "-j" jobs] { opam-version >= "2.1.5" }
  ["sh" "-exc" "PATH=%{ocaml-secondary-compiler:share}%/bin:$PATH ./_boot/dune.exe build dune.install --release --profile dune-bootstrap -j %{jobs}%" ] { opam-version < "2.1.5" }
  ["./_boot/dune.exe" "build" "dune.install" "--release" "--profile" "dune-bootstrap" "-j" jobs] { opam-version >= "2.1.5" }
  ["mv" "dune.install" "%{name}%.install"]
]
depends: [
  "ocaml-secondary-compiler" {>= "4.14.2"}
]
url {
  src:
    "https://github.com/ocaml/dune/archive/4f86203f77eb7ead7a07286b7728cbf42a386990.tar.gz"
}
x-commit-hash: "e4380ffddbdf924b3ec4c56048cd8331e1bf39ed"
