Improve the speed of register allocation
Target branch: trunk